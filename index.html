<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SAN Plan Lekcji</title>
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://use.typekit.net/vag8jnl.css">

</head>

<body>
  <div class="loader">
    <img id="loading-animation" src="img/loader.gif" alt="">
  </div>
  <span class="white" id="current-date"></span>


  <div class="timetable-container">
    <div class="timetable-header"><span class="white">Grafika 1 - Grupa 2</span></div>
    
    <div class="logo"><a id="logo-link" href="https://warszawa.san.edu.pl/strefa-studenta/strefa-studenta" target="_blank"></a></div>
    <div class="timeslot t1">
      <div class="hour-number">1</div>
      <div class="hour-time">8:00 - 9:30</div>
    </div>
    <div class="timeslot t2">
      <div class="hour-number">2</div>
      <div class="hour-time">9:45 - 11:15</div>
    </div>
    <div class="timeslot t3">
      <div class="hour-number">3</div>
      <div class="hour-time">11:30 - 13:00</div>
    </div>
    <div class="timeslot t4">
      <div class="hour-number">4</div>
      <div class="hour-time">13:15 - 14:45</div>
    </div>
    <div class="timeslot t5">
      <div class="hour-number">5</div>
      <div class="hour-time">15:00 - 16:30</div>
    </div>
    <div class="timeslot t6">
      <div class="hour-number">6</div>
      <div class="hour-time">16:45 - 18:15</div>
    </div>
    <div class="timeslot t7">
      <div class="hour-number">7</div>
      <div class="hour-time">18:30 - 20:00</div>
    </div>

    <div class="day pn">Pon</div>
    <div class="day wt">Wt</div>
    <div class="day sr">Śr</div>
    <div class="day cz">Czw</div>
    <div class="day pt">Pt</div>

    <div class="lesson pn1"></div>
    <div class="lesson pn2"></div>
    <div class="lesson pn3"></div>
    <div class="lesson pn4"></div>
    <div class="lesson pn5"></div>
    <div class="lesson pn6"></div>
    <div class="lesson pn7"></div>

    <div class="lesson wt1" l="liternictwo"></div>
    <div class="lesson wt2" l="fotografia"></div>
    <div class="lesson wt3" l="jezyk-obcy"></div>
    <div class="lesson wt4" l="rysunek-malarstwo"></div>
    <div class="lesson wt5" l="rysunek-malarstwo"></div>
    <div class="lesson wt6" l="tech-inf"></div>
    <div class="lesson wt7" l=""></div>

    <div class="lesson sr1"></div>
    <div class="lesson sr2"></div>
    <div class="lesson sr3"></div>
    <div class="lesson sr4" l="pfwidz-komwiz"></div>
    <div class="lesson sr5"></div>
    <div class="lesson sr6"></div>
    <div class="lesson sr7"></div>
    
    <div class="lesson cz1"></div>
    <div class="lesson cz2"></div>
    <div class="lesson cz3" l="grafika2d"></div>
    <div class="lesson cz4" l="test"></div>
    <div class="lesson cz5"></div>
    <div class="lesson cz6"></div>
    <div class="lesson cz7"></div>

    <div class="lesson pt1"></div>
    <div class="lesson pt2"></div>
    <div class="lesson pt3"></div>
    <div class="lesson pt4"></div>
    <div class="lesson pt5"></div>
    <div class="lesson pt6"></div>
    <div class="lesson pt7"></div>
  </div>

  <!-- <script src="index.js"></script> -->
  <script>
    const
    loader = document.querySelector('.loader'),
    monday = document.querySelector('.pn'),
    tuesday = document.querySelector('.wt'),
    wednesday = document.querySelector('.sr'),
    thursday = document.querySelector('.cz'),
    friday = document.querySelector('.pt'),
    lessons = document.querySelectorAll('.lesson');

    let activeDay, dayID, h, min, tMin, timeslot, lastTimeslot;

    let setActiveDay = element => {
      if (!element.classList.contains('active-day')) {
        document.querySelectorAll('.day').forEach(day => day.classList.remove('active-day'))
        element.classList.add('active-day')
        activeDay = element
      }
    }

    let clearActiveDays = () => {
      document.querySelectorAll('.day').forEach(day => { if (day.classList.contains('active-day')) { day.classList.remove('active-day') }})
      activeDay = false
      dayID = null
    }

    function clearActiveTimeslots() {
      document.querySelectorAll('.timeslot').forEach(e => {
        e.classList.remove('active-hour')
      })
    }

    function clearActiveLessons() {
      lessons.forEach(e => {
        e.classList.remove('active-lesson')
      })
    }

    const isBetween = (x,min,max) => {
        return x>=min && x<=max
    }

    const tRange = (now,t1,t2) => {
      t1 = t1.split(':'); t2 = t2.split(':');
      h1 = +t1[0]; min1 = +t1[1];
      h2 = +t2[0]; min2 = +t2[1];

      let min = h1*60+min1
      let max = h2*60+min2

      return isBetween(now,min,max)
    }

    setInterval(() => {
      now = new Date();
      // now.setDate(5)
      // now.setHours(11)
      // now.setMinutes(32)

      // Determine current day
      switch (now.getDay()) {
        case 1:
          setActiveDay(monday)
          dayID = 'pn'
          break
        case 2:
          setActiveDay(tuesday)
          dayID = 'wt'
          break
        case 3:
          setActiveDay(wednesday)
          dayID = 'sr'
          break
        case 4:
          setActiveDay(thursday)
          dayID = 'cz'
          break
        case 5: 
          setActiveDay(friday)
          dayID = 'pt'
          break
        default:
          clearActiveDays()
          break
      }
      
      h = now.getHours(),
      min = now.getMinutes(),
      tMin = h * 60 + min;

      if (timeslot) {
        lastTimeslot = timeslot
      }

      // Define timeslots
      if (activeDay) {
        timeslot = 
          tRange(tMin, '08:00','9:30')  ? 1 :
          tRange(tMin, '9:45','11:15')  ? 2 :
          tRange(tMin, '11:30','13:00') ? 3 :
          tRange(tMin, '13:15','14:45') ? 4 :
          tRange(tMin, '15:00','16:30') ? 5 :
          tRange(tMin, '16:45','18:15') ? 6 :
          tRange(tMin, '18:30','20:00') ? 7 :
          null;
      }

      if (timeslot && timeslot != lastTimeslot) {
        clearActiveTimeslots()
        clearActiveLessons()
      }
      
      // Highlight active lesson
      if (dayID && timeslot) {
        let activeLesson = document.querySelector(`.${dayID}${timeslot}`)
        if (!activeLesson.classList.contains('active-lesson')) {
          activeLesson.classList.add('active-lesson')
        }
      }

      // Highlight active timeslot
      if (dayID && timeslot) {
        let activeLesson = document.querySelector(`.t${timeslot}`)
        if (!activeLesson.classList.contains('active-hour')) {
          activeLesson.classList.add('active-hour')
        }
      }

      document.querySelector('#current-date').innerHTML = now.toString();
    },1)

    // Set lessons
    lessons.forEach(l => {
      let subject = teacher = subjectURL = teacherURL = " "
      
      switch (l.getAttribute('l')) {
        case 'test':
          subject = "INSERT TITLE HERE"
          teacher = "NAME SURNAME"
          subjectURL = "#"
          teacherURL = "#"
          break;
        case 'grafika2d':
          subject = "Warsztaty 2D-graf. wektorowa"
          teacher =  "Wójcik, Anna"
          subjectURL = "https://teams.microsoft.com/l/team/19%3afbcb1893464645e78a495d1c92cb1cc7%40thread.tacv2/conversations?groupId=ce32b94d-e92d-456f-8783-10bbf9add9ca&tenantId=262dbaf1-38a1-43f9-a7da-3022da85cc5e"
          teacherURL = "#"
          break
        case 'liternictwo':
          subject = "Liternictwo"
          teacher = "Tomsia, Szymon"
          subjectURL = "#"
          teacherURL = "#"
          break
        case 'fotografia':
          subject = "Fotografia"
          teacher = "Tomsia, Szymon"
          subjectURL = "#"
          teacherURL = "#"
          break
        case 'jezyk-obcy':
          subject = "Jezyk obcy"
          teacher = "???"
          subjectURL = "#"
          teacherURL = "#"
          break
        case 'rysunek-malarstwo':
          subject = "Rysunek/Malarstwo"
          teacher = "Sikora, Zbigniew"
          subjectURL = "#"
          teacherURL = "#"
          break
        case 'tech-inf':
          subject = "Technologie Informacyjne Ćw"
          teacher = "Kluka, Grzegorz"
          subjectURL = "#"
          teacherURL = "#"
          break
        case 'pfwidz-komwiz':
          subject = " "
          teacher = "Piątek, Maria"
          subjectURL = "#"
          teacherURL = "#"
          break
        default:
          break;
      }

      l.innerHTML =
`     <a href="${subjectURL}" target="_blank">
        <div class="subject">${subject}</div>
      </a>
      <a href="${teacherURL}" target="_blank">
        <div class="teacher">${teacher}</div>
      </a>`;
    })
  
  // Set lessons based on week number
  function getWeekNumber(d) {
    d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate()));
    d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay()||7));
    var yearStart = new Date(Date.UTC(d.getUTCFullYear(),0,1));
    var weekNo = Math.ceil(( ( (d - yearStart) / 86400000) + 1)/7);
    return [d.getUTCFullYear(), weekNo];
  }

  let currentWeek = getWeekNumber(new Date());

  const lessonTemplate = (element,subject,teacher,subjectURL,teacherURL) => {
    element.innerHTML =
`     <a href="${subjectURL}" target="_blank">
        <div class="subject">${subject}</div>
      </a>
      <a href="${teacherURL}" target="_blank">
        <div class="teacher">${teacher}</div>
      </a>`;
  }

  if (currentWeek[1] % 2) {
    document.querySelectorAll('*[l="rysunek-malarstwo"').forEach(e => {
      lessonTemplate(e,'Malarstwo','Sikora, Zbigniew','#','#')
    })
    document.querySelectorAll('*[l="pfwidz-komwiz"]').forEach(e => {
      lessonTemplate(e,'Psychofizjologia Widzenia','Piątek, Maria','#','#')
    })
  } else {
    document.querySelectorAll('*[l="rysunek-malarstwo"').forEach(e => {
      lessonTemplate(e,'Rysunek','Sikora, Zbigniew','#','#')
    })
    document.querySelectorAll('*[l="pfwidz-komwiz"]').forEach(e => {
      lessonTemplate(e,'Podstawy Komunikacji Wizualnej','Piątek, Maria','#','#')
    })
    document.querySelectorAll('*[l="tech-inf"]').forEach(e => {
      lessonTemplate(e,' ',' ',' ',' ')
    })
  }

    setTimeout(() => {
      loader.classList.add('hidden')
      loader.style.pointerEvents = 'none'
    }, 4040);
  </script>
</body>
</html>